Представьте, что вы вышли поговорить по телефону, перекусить или про￾сто погулять и оставили свой ноутбук без присмотра на 10-15 минут. Воз￾можно, вы сотрудник офиса или студент вуза, и у вас перерыв. При этом вы, 
как правильный пользователь, заблокировали свой комп. У вас даже шифро￾ванный HDD/SSD-диcк, стойкий пароль на вход в систему, установлены все 
необходимые обновления. Кажется, что все <<ОК>> и ваши данные в безопас￾ности. Но так ли это на самом деле? Давайте подумаем, что бы мог сделать 
хакер в таком случае. 
Первое, и самое простое, что злоумышленник может сделать при ограни￾ченном времени - это присоединиться к ноутбуку напрямую через витую 
пару. Ведь сделать это можно даже без входа в систему. Так он получит сете￾вой канал взаимодействия, который, возможно, позволит взломать компью￾тер одним из следующих способов: 
♦ уязвимости (MSl7-010, BlueKeep, PrintNightmare);
♦ NetBIOS/LLMNR spoofing (Responder);
♦ Bruteforce (SMB, RDP);
♦ MiTM (Eviigrade, BdfProxy, MSlб-101).
Каждый из указанных способов заслужил бы отдельного раздела, но это 
не тот случай. Предположим, что система достаточно <<свежая» и имеет все 
необходимые обновления, а пароль на вход более-менее стойкий. 
Второе, что может злоумышленник, - это перевести комп в спящий 
режим или гибернацию. В этих режимах диск не задействуется, подпитыва￾ется только RАМ. После этого можно извлечь жесткий диск и подключить￾ся к нему напрямую - например, с помощью девайса, изображенного на 
рис. 1.1. 
И в большинстве случаев этого окажется достаточно. Если перед злоу￾мышленником обычный незашифрованный HDD/SSD, то он может по￾лучить доступ ко всем документам и файлам, включая системные файлы, 
может извлечь пароли и т. д. При таком прямом доступе к диску можно не 
только довольствоваться пассивным чтением информации, но также изме￾нять данные на нем. Теоретически можно подменить системный компонент 
на диске и, вернув диск обратно в комп, успешно войти в пользовательскую 
22 Часть 1 . Физические атаки 
Рис. 1.1. USB-HDD адаптер для прямого доступа к диску 
сессию пятикратным нажатием юrавиши <Shift>. Для этого в файловой си￾стеме на диске достаточно поменять лишь один файл: 
мount /dev/sdЫ /мedia/hdd 
ер /мedia/hdd/Windows/Systeм32/cмd.exe. /мedia/hdd/Windows/Systeм32/sethc.exe 
Но этот сценарий мы далее не рассматриваем, так как он достаточно про￾стой, хотя и имеет свои тонкости. И все-таки цель злоумышленника - это 
компьютер с зашифрованным диском. 
Наконец, третье, что он может сделать, - атака холодной перезагрузки 
(Cold boot attack), о которой эта глава. 
1.1. Теория 
Cold boot attack - это широко известный способ получения доступа к опе￾ративной памяти (RАМ), использующий эффект сохранения данных в ней. 
Он достигается так называемой холодной перезагрузкой - перезагрузкой без 
использования ПО или, грубо говоря, аппаратной перезагрузкой. 
Почему не программной? Программная перезагрузка влечет за собой за￾крытие всех процессов и файлов, смаппленных в RАМ, и, возможно, даже 
ее принудительное затирание. Вот почему для атаки так важно сделать пере￾загрузку самостоятельно, без привлечения операционной системы (ОС), со￾хранив все ценные данные в памяти. 
Глава 1. Cold boot attack 23 
Осуществить указанную перезагрузку можно, как минимум, следующими 
способами: 
♦ аппаратное отключение/включение питания (очень быстро);
♦ аппаратный reset;
♦ Blue Screen of Death (BSOD).
В каждом из указанных способов ОС не успеет или не сможет затереть 
данные в RАМ перед перезагрузкой. Далее, если вставить загрузочную флеш￾ку, управление CPU может перейти уже на нее, и можно будет исполнить 
загрузочный код, который будет читать ту самую не затертую память. 
С системным блоком форм-фактора «tower» все пройдет на ОК. Но в 
случае с ноутбуками у злоумышленника возникнет ряд дополнительных 
проблем. Во-первых, только у малой части ноутбуков сейчас есть отдельная 
кнопка аппаратной перезагрузки. Во-вторых, современные ноутбуки часто 
не снабжаются съемными аккумуляторами, так что кратковременно вынуть 
аккумулятор вряд ли получится. В таком случае можно попробовать вызвать 
перезагрузку, вставив флешку со специально поврежденной файловой систе￾мой, которая может вызвать BSOD (рис. 1.2): 
git clone https://github.coм/мtivadar/wt.ndows10_ntfs_crash_dos 
dd if=tinyntfs of=/dev/sdb 
Для злоумышленника ошибка тут недопустима - ведь можно потерять 
данные в RАМ. Хотя современная Windows, которая так <<любит,> уходить в 
гибернацию, может сыграть ему на руку и вернет состояние RАМ из файла 
hiberfil.sys. 
В крайнем случае есть еще вариант с извлечением и охлаждением планок 
памяти DRAM/SRAM и переносом их на другую плату. Но этот вариант 
Рис. 1.2. B50D при обращении к специально поврежденной файловой системе на флешке 
24 Часть 1 . Физические атаки 
технически намного сложнее, реализуется не так быстро, так как требует 
разборки компьютера, поэтому мы его не рассматриваем. Другое дело загру￾зочная флешка - открытый USВ-порт есть почти везде. 
Все необходимые примитивы - это чтение физической памяти и прямая 
запись на жесткий диск - можно взять из следующего машинного кода: 
[огg 0х7С00] 
[bi.ts 16] 
resetdi.sk: 
моv ah, 0х00 ; reset functi.on 
�ov dl, 0х00 ; dri.ve 
i.nt 0х13 ; di.sk i.nt 
jc resetdi.sk 
gеtмем: 
моv Ьх, 0х0000 segмent 
моv es, Ьх 
моv Ьх, 0х8000 offset 
; es:bx = 0х0000:8000 
wri.tedi.sk: 
моv ah, 0х03 wri.te functi.on 
моv al, 0х01 sectors 
моv ch, 0х00 cyli.nder 
моv cl, 0х03 sector 
MOV dh, 0х00 head 
моv dl, 0х80 dri.ve 
i.nt 0х13 ; di.sk i.nt 
ti.мes 510 - ($ - $$) db 0х00 
db 0х55, 0хМ 
ti.мes 8096 db 0xfe 

Этот загрузочный код копирует 512 байтов оперативной памяти в сектор 
жесткого диска или флешки. 
Если скомпилировать и поместить этот код в самое начало любой флеш￾ки/диска, то BIOS выполнит его как загрузочный: 
nasм bootcode.asм 
qeмu-systeм-i.386 -hda bootcode 
У BIOS загрузочный код выполняется в реальном режиме (16-бит), 
и доступ к памяти идет по физическому адресу. Адрес читаемой RAM 
Глава 1. Cold boot attack 25 
указывается в паре регистров ES:BX. Доступ на запись к жесткому диску или 
флешке осуществляется посредством ОхlЗ ВIОS-прерывания (по сути, API 
BIOS). И в результате такого кода содержимое 512 байтов RАМ копируется 
на сектор HDD. Если завернуть этот участок кода в цикл, то можно считать 
всю RАМ целиком. 
Однако никакой код на ассемблере вам писать не придется. Уже есть 
удобный инструмент, который создан специально для этой атаки. И, как вы 
возможно, догадались, эксплуатировать cold boot attack можно простой за￾грузочной флешкой. 